<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <title>Waktu Solat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      background: url('https://source.unsplash.com/1600x900/?ramadan,mosque') no-repeat center center fixed;
      background-size: cover;
    }
    .quran-text {
      font-family: 'Amiri', serif;
      font-size: 1.5rem;
      direction: rtl;
      text-align: center;
      margin-top: 10px;
    }
    .quran-translation {
      font-family: 'Roboto', sans-serif;
      font-size: 1rem;
      text-align: center;
    }
    .logo {
      width: 100px;
      margin: 0 auto;
    }
    /* Kesan berkelip untuk waktu solat yang telah masuk */
    .blinking {
      color: cyan;
      animation: blink 2s linear infinite;
    }
    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body class="bg-gray-900 text-white">
  <div class="container mx-auto p-6 text-center">
    <img src="https://cdn-icons-png.flaticon.com/512/10031/10031075.png" alt="Logo" class="logo mb-4" />
    <h1 class="text-3xl font-bold mb-4">Waktu Solat - Malaysia</h1>

    <label for="zoneSelect" class="block text-lg font-semibold">Pilih Zon:</label>
    <!-- Dropdown disesuaikan untuk dark mode -->
    <select id="zoneSelect" class="mt-2 p-2 border border-gray-600 rounded bg-gray-800 text-white w-full" onchange="getPrayerTimes()">
      <option selected disabled>Pilih Zon</option>
      <!-- Contoh option (anda boleh mengekalkan semua pilihan asal) -->
      <optgroup label="Johor">
        <option value="JHR01">JHR01 - Pulau Aur dan Pulau Pemanggil</option>
        <option value="JHR02">JHR02 - Johor Bahru, Kota Tinggi, Mersing, Kulai</option>
        <!-- ... -->
      </optgroup>
      <!-- Tambah optgroup lain seperti asal -->
    </select>
    
<br><br>
    <!-- Tarikh dan Masa dipaparkan di sini -->
<p id="hijriDate" class="text-lg my-2"></p>
<p id="gregorianDate" class="text-lg my-2"></p>
<p id="currentTime" class="text-lg my-2"></p>
    <br>
    <div id="prayerTimes" class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-2"></div>

    
    <div class="bg-gray-700 text-white p-4 rounded-lg shadow-lg mt-6">
      <h2 class="text-lg font-semibold mb-2">Ayat Al-Quran</h2>
      <br>
      <!-- Teks ayat dalam Bahasa Arab -->
      <p id="quranVerse" class="quran-text"></p>
      <br>
      <!-- Rujukan: Surah & ayat -->
      <p id="quranReference" class="quran-translation mt-2"></p>
    </div>
    
    <br><br>
        <!-- Disclaimer mengenai sumber waktu solat -->
    <p class="text-sm text-gray-300 mb-4">
      Makluman: Waktu solat yang dipaparkan adalah daripada API e-Solat JAKIM.
    </p>
    
  </div>

  
  <!-- Footer hanya untuk copyright -->
  <footer class="text-center mt-6 text-gray-400">
    <p>&copy; 2025 Muhammad Aqil</p>
  </footer>

  <script>
    // Fungsi untuk menentukan jika waktu solat telah berlalu
    function isPastPrayer(time) {
      const now = new Date();
      const [hours, minutes] = time.split(':').map(Number);
      const prayerDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes);
      return now >= prayerDate;
    }

    async function getPrayerTimes() {
      const zone = document.getElementById("zoneSelect").value;
      if (!zone) return;
      try {
        const response = await fetch(`https://corsproxy.io/?https://www.e-solat.gov.my/index.php?r=esolatApi/TakwimSolat&period=week&zone=${zone}`);
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const data = await response.json();

        if (!data || !data.prayerTime || !Array.isArray(data.prayerTime)) {
          throw new Error("Invalid data format received from API");
        }

        const times = data.prayerTime[0];

        // Susunan waktu solat mengikut urutan
        const prayerOrder = ["imsak", "fajr", "syuruk", "dhuha", "dhuhr", "asr", "maghrib", "isha"];
        let activePrayer = null;
        // Cari waktu solat yang paling terkini (yang dah masuk)
        for (let key of prayerOrder) {
          if (times[key] && isPastPrayer(times[key])) {
            activePrayer = key;
          }
        }

        let output = '';
        const prayerNames = {
          "imsak": "Imsak",
          "fajr": "Subuh",
          "syuruk": "Syuruk",
          "dhuha": "Dhuha",
          "dhuhr": new Date().getDay() === 5 ? "Jumaat" : "Zohor",
          "asr": "Asar",
          "maghrib": "Maghrib",
          "isha": "Isyak"
        };

        Object.entries(prayerNames).forEach(([key, name]) => {
          if (times[key]) {
            let time12Hour = convertTo12Hour(times[key]);
            // Jika ini adalah waktu solat yang aktif (dah masuk), tambahkan kelas blinking
            let blinkingClass = (key === activePrayer) ? "blinking" : "";
            output += `<div class="bg-gray-800 p-4 rounded-lg shadow-md">
                        <h3 class="font-semibold">${name}</h3>
                        <p class="${blinkingClass}">${time12Hour}</p>
                      </div>`;
          }
        });
        document.getElementById("prayerTimes").innerHTML = output;
      } catch (error) {
        console.error("Error fetching prayer times:", error);
        alert("Gagal mendapatkan waktu solat. Sila cuba lagi nanti.");
      }
    }

    async function getQuranVerse() {
      try {
        const response = await fetch('https://api.alquran.cloud/v1/ayah/random');
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        const data = await response.json();

        if (!data || !data.data || !data.data.text || !data.data.surah) {
          throw new Error("Invalid data format received from API");
        }

        const verseText = data.data.text;
        const surahName = data.data.surah.englishName;
        const verseNumber = data.data.numberInSurah;
        const fullReference = `Surah ${surahName}, Ayat ${verseNumber}`;

        document.getElementById("quranVerse").innerText = verseText;
        document.getElementById("quranReference").innerText = fullReference;
      } catch (error) {
        console.error("Error fetching Quran verse:", error);
        document.getElementById("quranVerse").innerText = "Gagal mendapatkan ayat Al-Quran.";
        document.getElementById("quranReference").innerText = "";
      }
    }

    function displayDate() {
      const today = new Date();

      const daysInMalay = {
        "Sunday": "Ahad",
        "Monday": "Isnin",
        "Tuesday": "Selasa",
        "Wednesday": "Rabu",
        "Thursday": "Khamis",
        "Friday": "Jumaat",
        "Saturday": "Sabtu"
      };

      const monthsInMalay = {
        "January": "Januari",
        "February": "Februari",
        "March": "Mac",
        "April": "April",
        "May": "Mei",
        "June": "Jun",
        "July": "Julai",
        "August": "Ogos",
        "September": "September",
        "October": "Oktober",
        "November": "November",
        "December": "Disember"
      };

      const dayNameEnglish = today.toLocaleDateString('en-US', { weekday: 'long' });
      const monthNameEnglish = today.toLocaleDateString('en-US', { month: 'long' });

      const dayNameMalay = daysInMalay[dayNameEnglish];
      const monthNameMalay = monthsInMalay[monthNameEnglish];

      const formattedDate = `${dayNameMalay}, ${today.getDate()} ${monthNameMalay} ${today.getFullYear()}`;

      document.getElementById("gregorianDate").innerText = `ðŸ“… Tarikh Masihi: ${formattedDate}`;
      
      // TOLAK 1 HARI DARI TARIKH SEMASA UNTUK KIRAAN HIJRI YANG BETUL
      const hijriAdjusted = new Date(today.getTime() - 24 * 60 * 60 * 1000);
      document.getElementById("hijriDate").innerText = `ðŸ  Tarikh Hijri: ${Intl.DateTimeFormat('ar-SA-u-ca-islamic', { dateStyle: 'long' }).format(hijriAdjusted)}`;
    }

    function convertTo12Hour(time) {
      let [hours, minutes] = time.split(':').map(Number);
      let period = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12 || 12;
      return `${hours}:${minutes.toString().padStart(2, '0')} ${period}`;
    }

    // Fungsi untuk memaparkan masa sekarang dalam format 12 jam
    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString('en-US', {
        hour: 'numeric',
        minute: 'numeric',
        second: 'numeric',
        hour12: true
      });
      document.getElementById("currentTime").innerText = `ðŸ•’ Masa Sekarang: ${timeString}`;
    }

    // Panggilan fungsi awal dan kemaskini masa setiap saat
    getQuranVerse();
    displayDate();
    updateTime();
    setInterval(updateTime, 1000);
  </script>
</body>
</html>
